"use strict";

var _utils = require("../../../utils");

class ValidateOAS2Schema {
  static get rule() {
    return 'oas2-schema/schema';
  }

  get validators() {
    return {
      title(node, ctx) {
        if (node && node.title) {
          if (!(typeof node.title === 'string')) return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        }

        return null;
      },

      multipleOf(node, ctx) {
        if (node && node.multipleOf) {
          if (typeof node.multipleOf !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.multipleOf < 0) return ctx.createError('Value of multipleOf must be greater or equal to zero', 'value');
        }

        return null;
      },

      maximum(node, ctx) {
        if (node && node.maximum && typeof node.maximum !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      exclusiveMaximum(node, ctx) {
        if (node && node.exclusiveMaximum && typeof node.exclusiveMaximum !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      minimum(node, ctx) {
        if (node && node.minimum && typeof node.minimum !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
        return null;
      },

      exclusiveMinimum(node, ctx) {
        if (node && node.exclusiveMinimum && typeof node.exclusiveMinimum !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      maxLength(node, ctx) {
        if (node && node.maxLength) {
          if (typeof node.maxLength !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.maxLength < 0) return ctx.createError('Value of maxLength must be greater or equal to zero.', 'value');
        }

        return null;
      },

      minLength(node, ctx) {
        if (node && node.minLength) {
          if (typeof node.minLength !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.minLength < 0) return ctx.createError('Value of minLength must be greater or equal to zero.', 'value');
        }

        return null;
      },

      pattern(node, ctx) {
        if (node && node.pattern) {
          // TODO: add regexp validation.
          if (typeof node.pattern !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        }

        return null;
      },

      maxItems(node, ctx) {
        if (node && node.maxItems) {
          if (typeof node.maxItems !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.maxItems < 0) return ctx.createError('Value of maxItems must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      minItems(node, ctx) {
        if (node && node.minItems) {
          if (typeof node.minItems !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.minItems < 0) return ctx.createError('Value of minItems must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      uniqueItems(node, ctx) {
        if (node && node.uniqueItems) {
          if (typeof node.uniqueItems !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        }

        return null;
      },

      maxProperties(node, ctx) {
        if (node && node.maxProperties) {
          if (typeof node.maxProperties !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.maxProperties < 0) return ctx.createError('Value of maxProperties must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      minProperties(node, ctx) {
        if (node && node.minProperties) {
          if (typeof node.minProperties !== 'number') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('number'), 'value');
          if (node.minProperties < 0) return ctx.createError('Value of minProperties must be greater or equal to zero. You can`t have negative amount of something.', 'value');
        }

        return null;
      },

      required(node, ctx) {
        if (node && node.required) {
          if (!Array.isArray(node.required)) return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('array'), 'value');
          if (node.required.filter(item => typeof item !== 'string').length !== 0) return ctx.createError('All values of "required" field must be strings', 'value');
        }

        return null;
      },

      enum(node, ctx) {
        const errors = [];

        if (node && node.enum) {
          if (!Array.isArray(node.enum)) return [ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('array'), 'value')];
        }

        return errors;
      },

      type(node, ctx) {
        const errors = [];
        if (node.type && node.type && typeof node.type !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');

        if (node.type && !['string', 'object', 'array', 'integer', 'number', 'boolean'].includes(node.type)) {
          const possibleAlternate = (0, _utils.getClosestString)(node.type, ['string', 'object', 'array', 'integer', 'number', 'boolean']);
          errors.push(ctx.createError('Object type can be one of following only: "string", "object", "array", "integer", "number", "boolean".', 'value', {
            possibleAlternate
          }));
        }

        return errors;
      },

      items(node, ctx) {
        if (node && node.items && Array.isArray(node.items)) return ctx.createError('Value of items must not be an array. It must be a Schema object', 'value');
        return null;
      },

      additionalProperties: () => null,

      description(node, ctx) {
        if (node && node.description && typeof node.description !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      format(node, ctx) {
        if (node && node.format && typeof node.format !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      readOnly(node, ctx) {
        if (node && node.readOnly && typeof node.readOnly !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      },

      deprecated(node, ctx) {
        if (node && node.deprecated && typeof node.deprecated !== 'boolean') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('boolean'), 'value');
        return null;
      }

    };
  }

  OAS2Schema() {
    return {
      onEnter: (node, definition, ctx) => ctx.validateFields(this.config, this.rule, this.validators)
    };
  }

}

module.exports = ValidateOAS2Schema;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy92aXNpdG9ycy9ydWxlcy9vYXMyLXN0cnVjdHVyYWwvdmFsaWRhdGVPQVMyU2NoZW1hLmpzIl0sIm5hbWVzIjpbIlZhbGlkYXRlT0FTMlNjaGVtYSIsInJ1bGUiLCJ2YWxpZGF0b3JzIiwidGl0bGUiLCJub2RlIiwiY3R4IiwiY3JlYXRlRXJyb3IiLCJtZXNzYWdlSGVscGVycyIsImZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlciIsIm11bHRpcGxlT2YiLCJtYXhpbXVtIiwiZXhjbHVzaXZlTWF4aW11bSIsIm1pbmltdW0iLCJleGNsdXNpdmVNaW5pbXVtIiwibWF4TGVuZ3RoIiwibWluTGVuZ3RoIiwicGF0dGVybiIsIm1heEl0ZW1zIiwibWluSXRlbXMiLCJ1bmlxdWVJdGVtcyIsIm1heFByb3BlcnRpZXMiLCJtaW5Qcm9wZXJ0aWVzIiwicmVxdWlyZWQiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJpdGVtIiwibGVuZ3RoIiwiZW51bSIsImVycm9ycyIsInR5cGUiLCJpbmNsdWRlcyIsInBvc3NpYmxlQWx0ZXJuYXRlIiwicHVzaCIsIml0ZW1zIiwiYWRkaXRpb25hbFByb3BlcnRpZXMiLCJkZXNjcmlwdGlvbiIsImZvcm1hdCIsInJlYWRPbmx5IiwiZGVwcmVjYXRlZCIsIk9BUzJTY2hlbWEiLCJvbkVudGVyIiwiZGVmaW5pdGlvbiIsInZhbGlkYXRlRmllbGRzIiwiY29uZmlnIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFFQSxNQUFNQSxrQkFBTixDQUF5QjtBQUN2QixhQUFXQyxJQUFYLEdBQWtCO0FBQ2hCLFdBQU8sb0JBQVA7QUFDRDs7QUFFRCxNQUFJQyxVQUFKLEdBQWlCO0FBQ2YsV0FBTztBQUNMQyxNQUFBQSxLQUFLLENBQUNDLElBQUQsRUFBT0MsR0FBUCxFQUFZO0FBQ2YsWUFBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUNELEtBQWpCLEVBQXdCO0FBQ3RCLGNBQUks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QU9zQyxVQUFQLEVBQW1CckMsR0FBbkIsS0FBMkJBLEdBQUcsQ0FBQ3NDLGNBQUosQ0FDbEMsS0FBS0MsTUFENkIsRUFDckIsS0FBSzNDLElBRGdCLEVBQ1YsS0FBS0MsVUFESztBQUQvQixLQUFQO0FBS0Q7O0FBakpzQjs7QUFvSnpCMkMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCOUMsa0JBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWF0Y2hlc0pzb25TY2hlbWFUeXBlLCBnZXRDbG9zZXN0U3RyaW5nIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMnO1xuXG5jbGFzcyBWYWxpZGF0ZU9BUzJTY2hlbWEge1xuICBzdGF0aWMgZ2V0IHJ1bGUoKSB7XG4gICAgcmV0dXJuICdvYXMyLXNjaGVtYS9zY2hlbWEnO1xuICB9XG5cbiAgZ2V0IHZhbGlkYXRvcnMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRpdGxlKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLnRpdGxlKSB7XG4gICAgICAgICAgaWYgKCEodHlwZW9mIG5vZGUudGl0bGUgPT09ICdzdHJpbmcnKSkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbXVsdGlwbGVPZihub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5tdWx0aXBsZU9mKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLm11bHRpcGxlT2YgIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgICBpZiAobm9kZS5tdWx0aXBsZU9mIDwgMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgbXVsdGlwbGVPZiBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gemVybycsICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1heGltdW0obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWF4aW11bSAmJiB0eXBlb2Ygbm9kZS5tYXhpbXVtICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGV4Y2x1c2l2ZU1heGltdW0obm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZXhjbHVzaXZlTWF4aW11bSAmJiB0eXBlb2Ygbm9kZS5leGNsdXNpdmVNYXhpbXVtICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbWluaW11bShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5taW5pbXVtICYmIHR5cGVvZiBub2RlLm1pbmltdW0gIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZXhjbHVzaXZlTWluaW11bShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5leGNsdXNpdmVNaW5pbXVtICYmIHR5cGVvZiBub2RlLmV4Y2x1c2l2ZU1pbmltdW0gIT09ICdib29sZWFuJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdib29sZWFuJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtYXhMZW5ndGgobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWF4TGVuZ3RoKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLm1heExlbmd0aCAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICAgIGlmIChub2RlLm1heExlbmd0aCA8IDApIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIG1heExlbmd0aCBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gemVyby4nLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtaW5MZW5ndGgobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWluTGVuZ3RoKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLm1pbkxlbmd0aCAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICAgIGlmIChub2RlLm1pbkxlbmd0aCA8IDApIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIG1pbkxlbmd0aCBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gemVyby4nLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBwYXR0ZXJuKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLnBhdHRlcm4pIHtcbiAgICAgICAgICAvLyBUT0RPOiBhZGQgcmVnZXhwIHZhbGlkYXRpb24uXG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLnBhdHRlcm4gIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtYXhJdGVtcyhub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5tYXhJdGVtcykge1xuICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZS5tYXhJdGVtcyAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICAgIGlmIChub2RlLm1heEl0ZW1zIDwgMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignVmFsdWUgb2YgbWF4SXRlbXMgbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIHplcm8uIFlvdSBjYW5gdCBoYXZlIG5lZ2F0aXZlIGFtb3VudCBvZiBzb21ldGhpbmcuJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgbWluSXRlbXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWluSXRlbXMpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUubWluSXRlbXMgIT09ICdudW1iZXInKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ251bWJlcicpLCAndmFsdWUnKTtcbiAgICAgICAgICBpZiAobm9kZS5taW5JdGVtcyA8IDApIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIG1pbkl0ZW1zIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB6ZXJvLiBZb3UgY2FuYHQgaGF2ZSBuZWdhdGl2ZSBhbW91bnQgb2Ygc29tZXRoaW5nLicsICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIHVuaXF1ZUl0ZW1zKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLnVuaXF1ZUl0ZW1zKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBub2RlLnVuaXF1ZUl0ZW1zICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBtYXhQcm9wZXJ0aWVzKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLm1heFByb3BlcnRpZXMpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG5vZGUubWF4UHJvcGVydGllcyAhPT0gJ251bWJlcicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignbnVtYmVyJyksICd2YWx1ZScpO1xuICAgICAgICAgIGlmIChub2RlLm1heFByb3BlcnRpZXMgPCAwKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdWYWx1ZSBvZiBtYXhQcm9wZXJ0aWVzIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB6ZXJvLiBZb3UgY2FuYHQgaGF2ZSBuZWdhdGl2ZSBhbW91bnQgb2Ygc29tZXRoaW5nLicsICd2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG1pblByb3BlcnRpZXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUubWluUHJvcGVydGllcykge1xuICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZS5taW5Qcm9wZXJ0aWVzICE9PSAnbnVtYmVyJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdudW1iZXInKSwgJ3ZhbHVlJyk7XG4gICAgICAgICAgaWYgKG5vZGUubWluUHJvcGVydGllcyA8IDApIHJldHVybiBjdHguY3JlYXRlRXJyb3IoJ1ZhbHVlIG9mIG1pblByb3BlcnRpZXMgbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIHplcm8uIFlvdSBjYW5gdCBoYXZlIG5lZ2F0aXZlIGFtb3VudCBvZiBzb21ldGhpbmcuJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgcmVxdWlyZWQobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUucmVxdWlyZWQpIHtcbiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobm9kZS5yZXF1aXJlZCkpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYXJyYXknKSwgJ3ZhbHVlJyk7XG4gICAgICAgICAgaWYgKG5vZGUucmVxdWlyZWQuZmlsdGVyKChpdGVtKSA9PiB0eXBlb2YgaXRlbSAhPT0gJ3N0cmluZycpLmxlbmd0aCAhPT0gMCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcignQWxsIHZhbHVlcyBvZiBcInJlcXVpcmVkXCIgZmllbGQgbXVzdCBiZSBzdHJpbmdzJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgZW51bShub2RlLCBjdHgpIHtcbiAgICAgICAgY29uc3QgZXJyb3JzID0gW107XG5cbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5lbnVtKSB7XG4gICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KG5vZGUuZW51bSkpIHJldHVybiBbY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2FycmF5JyksICd2YWx1ZScpXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZXJyb3JzO1xuICAgICAgfSxcbiAgICAgIHR5cGUobm9kZSwgY3R4KSB7XG4gICAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuICAgICAgICBpZiAobm9kZS50eXBlICYmIG5vZGUudHlwZSAmJiB0eXBlb2Ygbm9kZS50eXBlICE9PSAnc3RyaW5nJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIGlmIChub2RlLnR5cGUgJiYgIVsnc3RyaW5nJywgJ29iamVjdCcsICdhcnJheScsICdpbnRlZ2VyJywgJ251bWJlcicsICdib29sZWFuJ10uaW5jbHVkZXMobm9kZS50eXBlKSkge1xuICAgICAgICAgIGNvbnN0IHBvc3NpYmxlQWx0ZXJuYXRlID0gZ2V0Q2xvc2VzdFN0cmluZyhub2RlLnR5cGUsIFsnc3RyaW5nJywgJ29iamVjdCcsICdhcnJheScsICdpbnRlZ2VyJywgJ251bWJlcicsICdib29sZWFuJ10pO1xuICAgICAgICAgIGVycm9ycy5wdXNoKGN0eC5jcmVhdGVFcnJvcignT2JqZWN0IHR5cGUgY2FuIGJlIG9uZSBvZiBmb2xsb3dpbmcgb25seTogXCJzdHJpbmdcIiwgXCJvYmplY3RcIiwgXCJhcnJheVwiLCBcImludGVnZXJcIiwgXCJudW1iZXJcIiwgXCJib29sZWFuXCIuJywgJ3ZhbHVlJywgeyBwb3NzaWJsZUFsdGVybmF0ZSB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVycm9ycztcbiAgICAgIH0sXG4gICAgICBpdGVtcyhub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5pdGVtcyAmJiBBcnJheS5pc0FycmF5KG5vZGUuaXRlbXMpKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdWYWx1ZSBvZiBpdGVtcyBtdXN0IG5vdCBiZSBhbiBhcnJheS4gSXQgbXVzdCBiZSBhIFNjaGVtYSBvYmplY3QnLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgYWRkaXRpb25hbFByb3BlcnRpZXM6ICgpID0+IG51bGwsXG4gICAgICBkZXNjcmlwdGlvbihub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5kZXNjcmlwdGlvbiAmJiB0eXBlb2Ygbm9kZS5kZXNjcmlwdGlvbiAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBmb3JtYXQobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZm9ybWF0ICYmIHR5cGVvZiBub2RlLmZvcm1hdCAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICByZWFkT25seShub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5yZWFkT25seSAmJiB0eXBlb2Ygbm9kZS5yZWFkT25seSAhPT0gJ2Jvb2xlYW4nKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ2Jvb2xlYW4nKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIGRlcHJlY2F0ZWQobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuZGVwcmVjYXRlZCAmJiB0eXBlb2Ygbm9kZS5kZXByZWNhdGVkICE9PSAnYm9vbGVhbicpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignYm9vbGVhbicpLCAndmFsdWUnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBPQVMyU2NoZW1hKCkge1xuICAgIHJldHVybiB7XG4gICAgICBvbkVudGVyOiAobm9kZSwgZGVmaW5pdGlvbiwgY3R4KSA9PiBjdHgudmFsaWRhdGVGaWVsZHMoXG4gICAgICAgIHRoaXMuY29uZmlnLCB0aGlzLnJ1bGUsIHRoaXMudmFsaWRhdG9ycyxcbiAgICAgICksXG4gICAgfTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFZhbGlkYXRlT0FTMlNjaGVtYTtcbiJdfQ==