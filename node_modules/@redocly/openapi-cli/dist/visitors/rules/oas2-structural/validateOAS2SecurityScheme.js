"use strict";

class ValidateOAS2SecurityScheme {
  static get rule() {
    return 'oas2-schema/security-scheme';
  }

  get validators() {
    return {
      type(node, ctx) {
        if (!node.type) return ctx.createError(ctx.messageHelpers.missingRequiredField('type'), 'key');
        if (typeof node.type !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      description(node, ctx) {
        if (typeof node.description !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      name(node, ctx) {
        if (!node.type || node.type !== 'apiKey') return null;
        if (!node.name) return ctx.createError(ctx.messageHelpers.missingRequiredField('name'), 'key');
        if (typeof node.name !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      in(node, ctx) {
        if (!node.type || node.type !== 'apiKey') return null;
        if (!node.in) return ctx.createError(ctx.messageHelpers.missingRequiredField('in'), 'key');
        if (typeof node.in !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        if (['query', 'header'].indexOf(node.in) === -1) return ctx.createError('Value of the "in" field can be only "query" or "header".', 'value');
        return null;
      },

      flow(node, ctx) {
        if (!node.type || node.type !== 'oauth2') return null;
        if (!node.flow) return ctx.createError(ctx.messageHelpers.missingRequiredField('flow'), 'key');
        if (typeof node.flow !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');

        if (['implicit', 'password', 'application', 'accessCode'].indexOf(node.flow) === -1) {
          return ctx.createError('Value of the "flow" field can be only "implicit", "password", "application", "accessCode".', 'value');
        }

        return null;
      },

      authorizationUrl(node, ctx) {
        if (!node.type || node.type !== 'oauth2') return null;
        if (!node.flow || ['implicit', 'accessCode'].indexOf(node.flow) === -1) return null;
        if (!node.authorizationUrl) return ctx.createError(ctx.messageHelpers.missingRequiredField('authorizationUrl'), 'key');
        if (typeof node.authorizationUrl !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      tokenUrl(node, ctx) {
        if (!node.type || node.type !== 'oauth2') return null;
        if (!node.flow || ['password', 'application', 'accessCode'].indexOf(node.flow) === -1) return null;
        if (!node.tokenUrl) return ctx.createError(ctx.messageHelpers.missingRequiredField('tokenUrl'), 'key');
        if (typeof node.tokenUrl !== 'string') return ctx.createError(ctx.messageHelpers.fieldTypeMismatchMessageHelper('string'), 'value');
        return null;
      },

      scopes(node, ctx) {
        if (!node.type || node.type !== 'oauth2') return null;
        if (!node.scopes) return ctx.createError(ctx.messageHelpers.missingRequiredField('scopes'), 'key');
        return null;
      }

    };
  }

  OAS2SecurityScheme() {
    return {
      onEnter: (node, definition, ctx) => ctx.validateFields(this.config, this.rule, this.validators)
    };
  }

}

module.exports = ValidateOAS2SecurityScheme;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy92aXNpdG9ycy9ydWxlcy9vYXMyLXN0cnVjdHVyYWwvdmFsaWRhdGVPQVMyU2VjdXJpdHlTY2hlbWUuanMiXSwibmFtZXMiOlsiVmFsaWRhdGVPQVMyU2VjdXJpdHlTY2hlbWUiLCJydWxlIiwidmFsaWRhdG9ycyIsInR5cGUiLCJub2RlIiwiY3R4IiwiY3JlYXRlRXJyb3IiLCJtZXNzYWdlSGVscGVycyIsIm1pc3NpbmdSZXF1aXJlZEZpZWxkIiwiZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyIiwiZGVzY3JpcHRpb24iLCJuYW1lIiwiaW4iLCJpbmRleE9mIiwiZmxvdyIsImF1dGhvcml6YXRpb25VcmwiLCJ0b2tlblVybCIsInNjb3BlcyIsIk9BUzJTZWN1cml0eVNjaGVtZSIsIm9uRW50ZXIiLCJkZWZpbml0aW9uIiwidmFsaWRhdGVGaWVsZHMiLCJjb25maWciLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLDBCQUFOLENBQWlDO0FBQy9CLGFBQVdDLElBQVgsR0FBa0I7QUFDaEIsV0FBTyw2QkFBUDtBQUNEOztBQUVELE1BQUlDLFVBQUosR0FBaUI7QUFDZixXQUFPO0FBQ0xDLE1BQUFBLElBQUksQ0FBQ0MsSUFBRCxFQUFPQyxHQUFQLEVBQVk7QUFDZCxZQUFJLENBQUNELElBQUksQ0FBQ0QsSUFBVixFQUFnQixPQUFPRSxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsb0JBQW5CLENBQXdDLE1BQXhDLENBQWhCLEVBQWlFLEtBQWpFLENBQVA7QUFDaEIsWUFBSSxPQUFPSixJQUFJLENBQUNELElBQVosS0FBcUIsUUFBekIsRUFBbUMsT0FBT0UsR0FBRyxDQUFDQyxXQUFKLENBQWdCRCxHQUFHLENBQUNFLGNBQUosQ0FBbUJFLDhCQUFuQixDQUFrRCxRQUFsRCxDQUFoQixFQUE2RSxPQUE3RSxDQUFQO0FBQ25DLGVBQU8sSUFBUDtBQUNELE9B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LEVBQW9CLE9BQU9YLEdBQUcsQ0FBQ0MsV0FBSixDQUFnQkQsR0FBRyxDQUFDRSxjQUFKLENBQW1CQyxvQkFBbkIsQ0FBd0MsVUFBeEMsQ0FBaEIsRUFBcUUsS0FBckUsQ0FBUDtBQUNwQixZQUFJLE9BQU9KLElBQUksQ0FBQ1ksUUFBWixLQUF5QixRQUE3QixFQUF1QyxPQUFPWCxHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkUsOEJBQW5CLENBQWtELFFBQWxELENBQWhCLEVBQTZFLE9BQTdFLENBQVA7QUFDdkMsZUFBTyxJQUFQO0FBQ0QsT0E3Q0k7O0FBOENMUSxNQUFBQSxNQUFNLENBQUNiLElBQUQsRUFBT0MsR0FBUCxFQUFZO0FBQ2hCLFlBQUksQ0FBQ0QsSUFBSSxDQUFDRCxJQUFOLElBQWNDLElBQUksQ0FBQ0QsSUFBTCxLQUFjLFFBQWhDLEVBQTBDLE9BQU8sSUFBUDtBQUMxQyxZQUFJLENBQUNDLElBQUksQ0FBQ2EsTUFBVixFQUFrQixPQUFPWixHQUFHLENBQUNDLFdBQUosQ0FBZ0JELEdBQUcsQ0FBQ0UsY0FBSixDQUFtQkMsb0JBQW5CLENBQXdDLFFBQXhDLENBQWhCLEVBQW1FLEtBQW5FLENBQVA7QUFDbEIsZUFBTyxJQUFQO0FBQ0Q7O0FBbERJLEtBQVA7QUFvREQ7O0FBRURVLEVBQUFBLGtCQUFrQixHQUFHO0FBQ25CLFdBQU87QUFDTEMsTUFBQUEsT0FBTyxFQUFFLENBQUNmLElBQUQsRUFBT2dCLFVBQVAsRUFBbUJmLEdBQW5CLEtBQTJCQSxHQUFHLENBQUNnQixjQUFKLENBQ2xDLEtBQUtDLE1BRDZCLEVBQ3JCLEtBQUtyQixJQURnQixFQUNWLEtBQUtDLFVBREs7QUFEL0IsS0FBUDtBQUtEOztBQWxFOEI7O0FBcUVqQ3FCLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnhCLDBCQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFZhbGlkYXRlT0FTMlNlY3VyaXR5U2NoZW1lIHtcbiAgc3RhdGljIGdldCBydWxlKCkge1xuICAgIHJldHVybiAnb2FzMi1zY2hlbWEvc2VjdXJpdHktc2NoZW1lJztcbiAgfVxuXG4gIGdldCB2YWxpZGF0b3JzKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlKG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAoIW5vZGUudHlwZSkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMubWlzc2luZ1JlcXVpcmVkRmllbGQoJ3R5cGUnKSwgJ2tleScpO1xuICAgICAgICBpZiAodHlwZW9mIG5vZGUudHlwZSAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBkZXNjcmlwdGlvbihub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBub2RlLmRlc2NyaXB0aW9uICE9PSAnc3RyaW5nJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSxcbiAgICAgIG5hbWUobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmICghbm9kZS50eXBlIHx8IG5vZGUudHlwZSAhPT0gJ2FwaUtleScpIHJldHVybiBudWxsO1xuICAgICAgICBpZiAoIW5vZGUubmFtZSkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMubWlzc2luZ1JlcXVpcmVkRmllbGQoJ25hbWUnKSwgJ2tleScpO1xuICAgICAgICBpZiAodHlwZW9mIG5vZGUubmFtZSAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBpbihub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKCFub2RlLnR5cGUgfHwgbm9kZS50eXBlICE9PSAnYXBpS2V5JykgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmICghbm9kZS5pbikgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMubWlzc2luZ1JlcXVpcmVkRmllbGQoJ2luJyksICdrZXknKTtcbiAgICAgICAgaWYgKHR5cGVvZiBub2RlLmluICE9PSAnc3RyaW5nJykgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMuZmllbGRUeXBlTWlzbWF0Y2hNZXNzYWdlSGVscGVyKCdzdHJpbmcnKSwgJ3ZhbHVlJyk7XG4gICAgICAgIGlmIChbJ3F1ZXJ5JywgJ2hlYWRlciddLmluZGV4T2Yobm9kZS5pbikgPT09IC0xKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdWYWx1ZSBvZiB0aGUgXCJpblwiIGZpZWxkIGNhbiBiZSBvbmx5IFwicXVlcnlcIiBvciBcImhlYWRlclwiLicsICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBmbG93KG5vZGUsIGN0eCkge1xuICAgICAgICBpZiAoIW5vZGUudHlwZSB8fCBub2RlLnR5cGUgIT09ICdvYXV0aDInKSByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYgKCFub2RlLmZsb3cpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLm1pc3NpbmdSZXF1aXJlZEZpZWxkKCdmbG93JyksICdrZXknKTtcbiAgICAgICAgaWYgKHR5cGVvZiBub2RlLmZsb3cgIT09ICdzdHJpbmcnKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5maWVsZFR5cGVNaXNtYXRjaE1lc3NhZ2VIZWxwZXIoJ3N0cmluZycpLCAndmFsdWUnKTtcbiAgICAgICAgaWYgKFsnaW1wbGljaXQnLCAncGFzc3dvcmQnLCAnYXBwbGljYXRpb24nLCAnYWNjZXNzQ29kZSddLmluZGV4T2Yobm9kZS5mbG93KSA9PT0gLTEpIHtcbiAgICAgICAgICByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKCdWYWx1ZSBvZiB0aGUgXCJmbG93XCIgZmllbGQgY2FuIGJlIG9ubHkgXCJpbXBsaWNpdFwiLCBcInBhc3N3b3JkXCIsIFwiYXBwbGljYXRpb25cIiwgXCJhY2Nlc3NDb2RlXCIuJywgJ3ZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgICAgYXV0aG9yaXphdGlvblVybChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKCFub2RlLnR5cGUgfHwgbm9kZS50eXBlICE9PSAnb2F1dGgyJykgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmICghbm9kZS5mbG93IHx8IFsnaW1wbGljaXQnLCAnYWNjZXNzQ29kZSddLmluZGV4T2Yobm9kZS5mbG93KSA9PT0gLTEpIHJldHVybiBudWxsO1xuICAgICAgICBpZiAoIW5vZGUuYXV0aG9yaXphdGlvblVybCkgcmV0dXJuIGN0eC5jcmVhdGVFcnJvcihjdHgubWVzc2FnZUhlbHBlcnMubWlzc2luZ1JlcXVpcmVkRmllbGQoJ2F1dGhvcml6YXRpb25VcmwnKSwgJ2tleScpO1xuICAgICAgICBpZiAodHlwZW9mIG5vZGUuYXV0aG9yaXphdGlvblVybCAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICB0b2tlblVybChub2RlLCBjdHgpIHtcbiAgICAgICAgaWYgKCFub2RlLnR5cGUgfHwgbm9kZS50eXBlICE9PSAnb2F1dGgyJykgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmICghbm9kZS5mbG93IHx8IFsncGFzc3dvcmQnLCAnYXBwbGljYXRpb24nLCAnYWNjZXNzQ29kZSddLmluZGV4T2Yobm9kZS5mbG93KSA9PT0gLTEpIHJldHVybiBudWxsO1xuICAgICAgICBpZiAoIW5vZGUudG9rZW5VcmwpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLm1pc3NpbmdSZXF1aXJlZEZpZWxkKCd0b2tlblVybCcpLCAna2V5Jyk7XG4gICAgICAgIGlmICh0eXBlb2Ygbm9kZS50b2tlblVybCAhPT0gJ3N0cmluZycpIHJldHVybiBjdHguY3JlYXRlRXJyb3IoY3R4Lm1lc3NhZ2VIZWxwZXJzLmZpZWxkVHlwZU1pc21hdGNoTWVzc2FnZUhlbHBlcignc3RyaW5nJyksICd2YWx1ZScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0sXG4gICAgICBzY29wZXMobm9kZSwgY3R4KSB7XG4gICAgICAgIGlmICghbm9kZS50eXBlIHx8IG5vZGUudHlwZSAhPT0gJ29hdXRoMicpIHJldHVybiBudWxsO1xuICAgICAgICBpZiAoIW5vZGUuc2NvcGVzKSByZXR1cm4gY3R4LmNyZWF0ZUVycm9yKGN0eC5tZXNzYWdlSGVscGVycy5taXNzaW5nUmVxdWlyZWRGaWVsZCgnc2NvcGVzJyksICdrZXknKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBPQVMyU2VjdXJpdHlTY2hlbWUoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG9uRW50ZXI6IChub2RlLCBkZWZpbml0aW9uLCBjdHgpID0+IGN0eC52YWxpZGF0ZUZpZWxkcyhcbiAgICAgICAgdGhpcy5jb25maWcsIHRoaXMucnVsZSwgdGhpcy52YWxpZGF0b3JzLFxuICAgICAgKSxcbiAgICB9O1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gVmFsaWRhdGVPQVMyU2VjdXJpdHlTY2hlbWU7XG4iXX0=