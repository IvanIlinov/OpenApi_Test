"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _path = _interopRequireDefault(require("path"));

var _resolver = _interopRequireWildcard(require("./resolver"));

var _resolveDefinition = _interopRequireDefault(require("./resolveDefinition"));

var _resolveType = _interopRequireDefault(require("./resolveType"));

var _scalarsResolver = _interopRequireDefault(require("./scalarsResolver"));

var _default2 = require("./error/default");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint-disable no-await-in-loop */

/* eslint-disable no-underscore-dangle */

/* eslint-disable no-case-declarations */
async function traverseChildren(resolvedNode, definition, ctx, visited) {
  let nodeChildren;
  const errors = [];

  switch (typeof definition.properties) {
    case 'function':
      nodeChildren = definition.properties(resolvedNode);
      const childrenNames = Object.keys(nodeChildren);
      const resolvedNodeKeys = Object.keys(resolvedNode);

      for (let i = 0; i < childrenNames.length; i += 1) {
        const child = childrenNames[i];
        let childResult = [];

        if (resolvedNodeKeys.includes(child)) {
          ctx.path.push(child);

          if (resolvedNode[child]) {
            childResult = await traverseNode(resolvedNode[child], nodeChildren[child], ctx, visited);
          }

          if (childResult) errors.push(...childResult);
          ctx.path.pop();
        }
      }

      break;

    case 'object':
      const props = Object.keys(definition.properties);

      for (let i = 0; i < props.length; i += 1) {
        const p = props[i];
        let propResult = [];
        ctx.path.push(p);

        if (typeof definition.properties[p] === 'function') {
          if (resolvedNode[p]) {
            propResult = await traverseNode(resolvedNode[p], definition.properties[p](), ctx, visited);
          }
        } else if (resolvedNode[p]) {
          propResult = await traverseNode(resolvedNode[p], definition.properties[p], ctx, visited);
        }

        if (propResult) errors.push(...propResult);
        ctx.path.pop();
      }

      break;

    default: // do nothing

  }

  return errors;
}

async function onNodeEnter(node, ctx) {
  const {
    node: resolvedNode,
    onStack
  } = await (0, _resolver.default)(node, ctx);
  return {
    resolvedNode,
    onStack
  };
}

function onNodeExit(nodeContext, ctx) {
  if (nodeContext.onStack) {
    (0, _resolver.popPath)(ctx);
  }
}

const nestedIncludes = (c, s) => {
  const res = s.find(el => el === s) !== undefined;
  return res;
};

async function traverseNode(node, definition, ctx, visited = []) {
  if (!node || !definition) return [];
  const nodeContext = await onNodeEnter(node, ctx);
  const isRecursive = nestedIncludes(ctx.path, visited);
  const errors = [];
  const currentPath = `${_path.default.relative(process.cwd(), ctx.filePath)}::${ctx.path.join('/')}`;
  const localVisited = Array.from(visited);
  localVisited.push(currentPath);
  const resolvedDefinition = (0, _resolveDefinition.default)(definition, ctx, nodeContext.resolvedNode);
  ctx.definitionStack.push(resolvedDefinition);
  (0, _scalarsResolver.default)(nodeContext.resolvedNode, definition, ctx);

  if (definition.customResolveFields) {
    await definition.customResolveFields(nodeContext.resolvedNode, ctx, visited);
  }

  if (Array.isArray(nodeContext.resolvedNode)) {
    for (let i = 0; i < nodeContext.resolvedNode.length; i++) {
      ctx.path.push(i);
      const arrayResult = await traverseNode(nodeContext.resolvedNode[i], resolvedDefinition, ctx, localVisited);
      if (arrayResult) errors.push(...arrayResult);
      ctx.path.pop();
    }
  } else {
    ctx.validateFields = ctx.validateFieldsRaw.bind(null, nodeContext.resolvedNode, ctx);
    await runRuleOnRuleset(nodeContext, 'onEnter', ctx, resolvedDefinition, node, errors, localVisited);
    const newNode = !isRecursive && (!resolvedDefinition.isIdempotent || !ctx.visited.includes(currentPath));

    if (newNode) {
      if (!ctx.visited.includes(currentPath)) ctx.visited.push(currentPath);
      const errorsChildren = await traverseChildren(nodeContext.resolvedNode, resolvedDefinition, ctx, localVisited);
      errors.push(...errorsChildren);
    } else {
      // Will use cached result if we have already traversed this nodes children
      const cachedResult = ctx.cache[currentPath] ? ctx.cache[currentPath].map(r => (0, _default2.fromError)(r, ctx)) : [];
      ctx.result.push(...cachedResult);
    }

    await runRuleOnRuleset(nodeContext, 'onExit', ctx, resolvedDefinition, node, errors);
    if (newNode) ctx.cache[currentPath] = errors;
  }

  onNodeExit(nodeContext, ctx);
  ctx.definitionStack.pop();
  return errors;
}

async function runRuleOnRuleset(nodeContext, ruleName, ctx, definition, node, errors, visited) {
  for (let i = 0; i < ctx.customRules.length; i += 1) {
    ctx.validateFieldsHelper = ctx.validateFields.bind(null, ctx.customRules[i]._config, ctx.customRules[i].constructor.rule);
    ctx.createError = _default2.createErrorFlat.bind(null, nodeContext.resolvedNode, ctx, ctx.customRules[i].constructor.rule, ctx.customRules[i].config ? ctx.customRules[i].config.level : ctx.customRules[i]._config.level);
    const errorsOnEnterForType = ctx.customRules[i][definition.name] && ctx.customRules[i][definition.name]()[ruleName] ? await ctx.customRules[i][definition.name]()[ruleName](nodeContext.resolvedNode, definition, ctx, node, {
      traverseNode,
      visited,
      resolveType: _resolveType.default
    }) : [];
    const errorsOnEnterGeneric = ctx.customRules[i].any && ctx.customRules[i].any()[ruleName] ? await ctx.customRules[i].any()[ruleName](nodeContext.resolvedNode, definition, ctx, node, {
      traverseNode,
      visited,
      resolveType: _resolveType.default
    }) : [];

    if (Array.isArray(errorsOnEnterForType)) {
      ctx.result.push(...errorsOnEnterForType);
      errors.push(...errorsOnEnterForType);
    }

    if (Array.isArray(errorsOnEnterGeneric)) {
      ctx.result.push(...errorsOnEnterGeneric);
      errors.push(...errorsOnEnterGeneric);
    }
  }
}

var _default = traverseNode;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90cmF2ZXJzZS5qcyJdLCJuYW1lcyI6WyJ0cmF2ZXJzZUNoaWxkcmVuIiwicmVzb2x2ZWROb2RlIiwiZGVmaW5pdGlvbiIsImN0eCIsInZpc2l0ZWQiLCJub2RlQ2hpbGRyZW4iLCJlcnJvcnMiLCJwcm9wZXJ0aWVzIiwiY2hpbGRyZW5OYW1lcyIsIk9iamVjdCIsImtleXMiLCJyZXNvbHZlZE5vZGVLZXlzIiwiaSIsImxlbmd0aCIsImNoaWxkIiwiY2hpbGRSZXN1bHQiLCJpbmNsdWRlcyIsInBhdGgiLCJwdXNoIiwidHJhdmVyc2VOb2RlIiwicG9wIiwicHJvcHMiLCJwIiwicHJvcFJlc3VsdCIsIm9uTm9kZUVudGVyIiwibm9kZSIsIm9uU3RhY2siLCJvbk5vZGVFeGl0Iiwibm9kZUNvbnRleHQiLCJuZXN0ZWRJbmNsdWRlcyIsImMiLCJzIiwicmVzIiwiZmluZCIsImVsIiwidW5kZWZpbmVkIiwiaXNSZWN1cnNpdmUiLCJjdXJyZW50UGF0aCIsInJlbGF0aXZlIiwicHJvY2VzcyIsImN3ZCIsImZpbGVQYXRoIiwiam9pbiIsImxvY2FsVmlzaXRlZCIsIkFycmF5IiwiZnJvbSIsInJlc29sdmVkRGVmaW5pdGlvbiIsImRlZmluaXRpb25TdGFjayIsImN1c3RvbVJlc29sdmVGaWVsZHMiLCJpc0FycmF5IiwiYXJyYXlSZXN1bHQiLCJ2YWxpZGF0ZUZpZWxkcyIsInZhbGlkYXRlRmllbGRzUmF3IiwiYmluZCIsInJ1blJ1bGVPblJ1bGVzZXQiLCJuZXdOb2RlIiwiaXNJZGVtcG90ZW50IiwiZXJyb3JzQ2hpbGRyZW4iLCJjYWNoZWRSZXN1bHQiLCJjYWNoZSIsIm1hcCIsInIiLCJyZXN1bHQiLCJydWxlTmFtZSIsImN1c3RvbVJ1bGVzIiwidmFsaWRhdGVGaWVsZHNIZWxwZXIiLCJfY29uZmlnIiwiY29uc3RydWN0b3IiLCJydWxlIiwiY3JlYXRlRXJyb3IiLCJjcmVhdGVFcnJvckZsYXQiLCJjb25maWciLCJsZXZlbCIsImVycm9yc09uRW50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QUExQixHQUN6QixNQUFNNUQsR0FBRyxDQUFDNkQsV0FBSixDQUFnQnBELENBQWhCLEVBQW1CaUUsR0FBbkIsR0FBeUJkLFFBQXpCLEVBQW1DbkMsV0FBVyxDQUFDM0IsWUFBL0MsRUFBNkRDLFVBQTdELEVBQXlFQyxHQUF6RSxFQUE4RXNCLElBQTlFLEVBQW9GO0FBQzFGTixNQUFBQSxZQUQwRjtBQUM1RWYsTUFBQUEsT0FENEU7QUFDbkV1RSxNQUFBQSxXQUFXLEVBQVhBO0FBRG1FLEtBQXBGLENBRG1CLEdBR3RCLEVBSFA7O0FBTUEsUUFBSS9CLEtBQUssQ0FBQ0ssT0FBTixDQUFjd0Isb0JBQWQsQ0FBSixFQUF5QztBQUN2Q3RFLE1BQUFBLEdBQUcsQ0FBQzJELE1BQUosQ0FBVzVDLElBQVgsQ0FBZ0IsR0FBR3VELG9CQUFuQjtBQUNBbkUsTUFBQUEsTUFBTSxDQUFDWSxJQUFQLENBQVksR0FBR3VELG9CQUFmO0FBQ0Q7O0FBRUQsUUFBSTdCLEtBQUssQ0FBQ0ssT0FBTixDQUFjMkIsb0JBQWQsQ0FBSixFQUF5QztBQUN2Q3pFLE1BQUFBLEdBQUcsQ0FBQzJELE1BQUosQ0FBVzVDLElBQVgsQ0FBZ0IsR0FBRzBELG9CQUFuQjtBQUNBdEUsTUFBQUEsTUFBTSxDQUFDWSxJQUFQLENBQVksR0FBRzBELG9CQUFmO0FBQ0Q7QUFDRjtBQUNGOztlQUVjekQsWSIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG5vLWF3YWl0LWluLWxvb3AgKi9cbi8qIGVzbGludC1kaXNhYmxlIG5vLXVuZGVyc2NvcmUtZGFuZ2xlICovXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1jYXNlLWRlY2xhcmF0aW9ucyAqL1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmltcG9ydCByZXNvbHZlTm9kZSwgeyBwb3BQYXRoIH0gZnJvbSAnLi9yZXNvbHZlcic7XG5pbXBvcnQgcmVzb2x2ZURlZmluaXRpb24gZnJvbSAnLi9yZXNvbHZlRGVmaW5pdGlvbic7XG5pbXBvcnQgcmVzb2x2ZVR5cGUgZnJvbSAnLi9yZXNvbHZlVHlwZSc7XG5pbXBvcnQgcmVzb2x2ZVNjYWxhcnMgZnJvbSAnLi9zY2FsYXJzUmVzb2x2ZXInO1xuXG5pbXBvcnQgeyBmcm9tRXJyb3IsIGNyZWF0ZUVycm9yRmxhdCB9IGZyb20gJy4vZXJyb3IvZGVmYXVsdCc7XG5cbmFzeW5jIGZ1bmN0aW9uIHRyYXZlcnNlQ2hpbGRyZW4ocmVzb2x2ZWROb2RlLCBkZWZpbml0aW9uLCBjdHgsIHZpc2l0ZWQpIHtcbiAgbGV0IG5vZGVDaGlsZHJlbjtcbiAgY29uc3QgZXJyb3JzID0gW107XG4gIHN3aXRjaCAodHlwZW9mIGRlZmluaXRpb24ucHJvcGVydGllcykge1xuICAgIGNhc2UgJ2Z1bmN0aW9uJzpcbiAgICAgIG5vZGVDaGlsZHJlbiA9IGRlZmluaXRpb24ucHJvcGVydGllcyhyZXNvbHZlZE5vZGUpO1xuICAgICAgY29uc3QgY2hpbGRyZW5OYW1lcyA9IE9iamVjdC5rZXlzKG5vZGVDaGlsZHJlbik7XG4gICAgICBjb25zdCByZXNvbHZlZE5vZGVLZXlzID0gT2JqZWN0LmtleXMocmVzb2x2ZWROb2RlKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRyZW5OYW1lcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBjb25zdCBjaGlsZCA9IGNoaWxkcmVuTmFtZXNbaV07XG4gICAgICAgIGxldCBjaGlsZFJlc3VsdCA9IFtdO1xuICAgICAgICBpZiAocmVzb2x2ZWROb2RlS2V5cy5pbmNsdWRlcyhjaGlsZCkpIHtcbiAgICAgICAgICBjdHgucGF0aC5wdXNoKGNoaWxkKTtcbiAgICAgICAgICBpZiAocmVzb2x2ZWROb2RlW2NoaWxkXSkge1xuICAgICAgICAgICAgY2hpbGRSZXN1bHQgPSBhd2FpdCB0cmF2ZXJzZU5vZGUocmVzb2x2ZWROb2RlW2NoaWxkXSwgbm9kZUNoaWxkcmVuW2NoaWxkXSwgY3R4LCB2aXNpdGVkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGNoaWxkUmVzdWx0KSBlcnJvcnMucHVzaCguLi5jaGlsZFJlc3VsdCk7XG4gICAgICAgICAgY3R4LnBhdGgucG9wKCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgIGNvbnN0IHByb3BzID0gT2JqZWN0LmtleXMoZGVmaW5pdGlvbi5wcm9wZXJ0aWVzKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgY29uc3QgcCA9IHByb3BzW2ldO1xuICAgICAgICBsZXQgcHJvcFJlc3VsdCA9IFtdO1xuICAgICAgICBjdHgucGF0aC5wdXNoKHApO1xuICAgICAgICBpZiAodHlwZW9mIGRlZmluaXRpb24ucHJvcGVydGllc1twXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGlmIChyZXNvbHZlZE5vZGVbcF0pIHtcbiAgICAgICAgICAgIHByb3BSZXN1bHQgPSBhd2FpdCB0cmF2ZXJzZU5vZGUocmVzb2x2ZWROb2RlW3BdLCBkZWZpbml0aW9uLnByb3BlcnRpZXNbcF0oKSwgY3R4LCB2aXNpdGVkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAocmVzb2x2ZWROb2RlW3BdKSB7XG4gICAgICAgICAgcHJvcFJlc3VsdCA9IGF3YWl0IHRyYXZlcnNlTm9kZShyZXNvbHZlZE5vZGVbcF0sIGRlZmluaXRpb24ucHJvcGVydGllc1twXSwgY3R4LCB2aXNpdGVkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHJvcFJlc3VsdCkgZXJyb3JzLnB1c2goLi4ucHJvcFJlc3VsdCk7XG4gICAgICAgIGN0eC5wYXRoLnBvcCgpO1xuICAgICAgfVxuXG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgICAvLyBkbyBub3RoaW5nXG4gIH1cbiAgcmV0dXJuIGVycm9ycztcbn1cblxuYXN5bmMgZnVuY3Rpb24gb25Ob2RlRW50ZXIobm9kZSwgY3R4KSB7XG4gIGNvbnN0IHtcbiAgICBub2RlOiByZXNvbHZlZE5vZGUsIG9uU3RhY2ssXG4gIH0gPSBhd2FpdCByZXNvbHZlTm9kZShub2RlLCBjdHgpO1xuXG4gIHJldHVybiB7XG4gICAgcmVzb2x2ZWROb2RlLFxuICAgIG9uU3RhY2ssXG4gIH07XG59XG5cbmZ1bmN0aW9uIG9uTm9kZUV4aXQobm9kZUNvbnRleHQsIGN0eCkge1xuICBpZiAobm9kZUNvbnRleHQub25TdGFjaykge1xuICAgIHBvcFBhdGgoY3R4KTtcbiAgfVxufVxuXG5jb25zdCBuZXN0ZWRJbmNsdWRlcyA9IChjLCBzKSA9PiB7XG4gIGNvbnN0IHJlcyA9IHMuZmluZCgoZWwpID0+IGVsID09PSBzKSAhPT0gdW5kZWZpbmVkO1xuICByZXR1cm4gcmVzO1xufTtcblxuXG5hc3luYyBmdW5jdGlvbiB0cmF2ZXJzZU5vZGUobm9kZSwgZGVmaW5pdGlvbiwgY3R4LCB2aXNpdGVkID0gW10pIHtcbiAgaWYgKCFub2RlIHx8ICFkZWZpbml0aW9uKSByZXR1cm4gW107XG5cbiAgY29uc3Qgbm9kZUNvbnRleHQgPSBhd2FpdCBvbk5vZGVFbnRlcihub2RlLCBjdHgpO1xuICBjb25zdCBpc1JlY3Vyc2l2ZSA9IG5lc3RlZEluY2x1ZGVzKGN0eC5wYXRoLCB2aXNpdGVkKTtcbiAgY29uc3QgZXJyb3JzID0gW107XG4gIGNvbnN0IGN1cnJlbnRQYXRoID0gYCR7cGF0aC5yZWxhdGl2ZShwcm9jZXNzLmN3ZCgpLCBjdHguZmlsZVBhdGgpfTo6JHtjdHgucGF0aC5qb2luKCcvJyl9YDtcblxuICBjb25zdCBsb2NhbFZpc2l0ZWQgPSBBcnJheS5mcm9tKHZpc2l0ZWQpO1xuICBsb2NhbFZpc2l0ZWQucHVzaChjdXJyZW50UGF0aCk7XG5cbiAgY29uc3QgcmVzb2x2ZWREZWZpbml0aW9uID0gcmVzb2x2ZURlZmluaXRpb24oZGVmaW5pdGlvbiwgY3R4LCBub2RlQ29udGV4dC5yZXNvbHZlZE5vZGUpO1xuXG4gIGN0eC5kZWZpbml0aW9uU3RhY2sucHVzaChyZXNvbHZlZERlZmluaXRpb24pO1xuICByZXNvbHZlU2NhbGFycyhub2RlQ29udGV4dC5yZXNvbHZlZE5vZGUsIGRlZmluaXRpb24sIGN0eCk7XG5cbiAgaWYgKGRlZmluaXRpb24uY3VzdG9tUmVzb2x2ZUZpZWxkcykge1xuICAgIGF3YWl0IGRlZmluaXRpb24uY3VzdG9tUmVzb2x2ZUZpZWxkcyhub2RlQ29udGV4dC5yZXNvbHZlZE5vZGUsIGN0eCwgdmlzaXRlZCk7XG4gIH1cblxuICBpZiAoQXJyYXkuaXNBcnJheShub2RlQ29udGV4dC5yZXNvbHZlZE5vZGUpKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2RlQ29udGV4dC5yZXNvbHZlZE5vZGUubGVuZ3RoOyBpKyspIHtcbiAgICAgIGN0eC5wYXRoLnB1c2goaSk7XG4gICAgICBjb25zdCBhcnJheVJlc3VsdCA9IGF3YWl0IHRyYXZlcnNlTm9kZShub2RlQ29udGV4dC5yZXNvbHZlZE5vZGVbaV0sIHJlc29sdmVkRGVmaW5pdGlvbiwgY3R4LCBsb2NhbFZpc2l0ZWQpO1xuICAgICAgaWYgKGFycmF5UmVzdWx0KSBlcnJvcnMucHVzaCguLi5hcnJheVJlc3VsdCk7XG4gICAgICBjdHgucGF0aC5wb3AoKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgY3R4LnZhbGlkYXRlRmllbGRzID0gY3R4LnZhbGlkYXRlRmllbGRzUmF3LmJpbmQoXG4gICAgICBudWxsLCBub2RlQ29udGV4dC5yZXNvbHZlZE5vZGUsIGN0eCxcbiAgICApO1xuICAgIGF3YWl0IHJ1blJ1bGVPblJ1bGVzZXQobm9kZUNvbnRleHQsICdvbkVudGVyJywgY3R4LCByZXNvbHZlZERlZmluaXRpb24sIG5vZGUsIGVycm9ycywgbG9jYWxWaXNpdGVkKTtcblxuICAgIGNvbnN0IG5ld05vZGUgPSAhaXNSZWN1cnNpdmVcbiAgICAgICYmICghcmVzb2x2ZWREZWZpbml0aW9uLmlzSWRlbXBvdGVudCB8fCAhY3R4LnZpc2l0ZWQuaW5jbHVkZXMoY3VycmVudFBhdGgpKTtcbiAgICBpZiAobmV3Tm9kZSkge1xuICAgICAgaWYgKCFjdHgudmlzaXRlZC5pbmNsdWRlcyhjdXJyZW50UGF0aCkpIGN0eC52aXNpdGVkLnB1c2goY3VycmVudFBhdGgpO1xuXG4gICAgICBjb25zdCBlcnJvcnNDaGlsZHJlbiA9IGF3YWl0IHRyYXZlcnNlQ2hpbGRyZW4oXG4gICAgICAgIG5vZGVDb250ZXh0LnJlc29sdmVkTm9kZSwgcmVzb2x2ZWREZWZpbml0aW9uLCBjdHgsIGxvY2FsVmlzaXRlZCxcbiAgICAgICk7XG4gICAgICBlcnJvcnMucHVzaCguLi5lcnJvcnNDaGlsZHJlbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFdpbGwgdXNlIGNhY2hlZCByZXN1bHQgaWYgd2UgaGF2ZSBhbHJlYWR5IHRyYXZlcnNlZCB0aGlzIG5vZGVzIGNoaWxkcmVuXG4gICAgICBjb25zdCBjYWNoZWRSZXN1bHQgPSBjdHguY2FjaGVbY3VycmVudFBhdGhdXG4gICAgICAgID8gY3R4LmNhY2hlW2N1cnJlbnRQYXRoXS5tYXAoKHIpID0+IGZyb21FcnJvcihyLCBjdHgpKVxuICAgICAgICA6IFtdO1xuXG4gICAgICBjdHgucmVzdWx0LnB1c2goLi4uY2FjaGVkUmVzdWx0KTtcbiAgICB9XG5cbiAgICBhd2FpdCBydW5SdWxlT25SdWxlc2V0KG5vZGVDb250ZXh0LCAnb25FeGl0JywgY3R4LCByZXNvbHZlZERlZmluaXRpb24sIG5vZGUsIGVycm9ycyk7XG4gICAgaWYgKG5ld05vZGUpIGN0eC5jYWNoZVtjdXJyZW50UGF0aF0gPSBlcnJvcnM7XG4gIH1cbiAgb25Ob2RlRXhpdChub2RlQ29udGV4dCwgY3R4KTtcbiAgY3R4LmRlZmluaXRpb25TdGFjay5wb3AoKTtcbiAgcmV0dXJuIGVycm9ycztcbn1cblxuYXN5bmMgZnVuY3Rpb24gcnVuUnVsZU9uUnVsZXNldChub2RlQ29udGV4dCwgcnVsZU5hbWUsIGN0eCwgZGVmaW5pdGlvbiwgbm9kZSwgZXJyb3JzLCB2aXNpdGVkKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY3R4LmN1c3RvbVJ1bGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgY3R4LnZhbGlkYXRlRmllbGRzSGVscGVyID0gY3R4LnZhbGlkYXRlRmllbGRzLmJpbmQoXG4gICAgICBudWxsLFxuICAgICAgY3R4LmN1c3RvbVJ1bGVzW2ldLl9jb25maWcsXG4gICAgICBjdHguY3VzdG9tUnVsZXNbaV0uY29uc3RydWN0b3IucnVsZSxcbiAgICApO1xuXG4gICAgY3R4LmNyZWF0ZUVycm9yID0gY3JlYXRlRXJyb3JGbGF0LmJpbmQoXG4gICAgICBudWxsLFxuICAgICAgbm9kZUNvbnRleHQucmVzb2x2ZWROb2RlLFxuICAgICAgY3R4LFxuICAgICAgY3R4LmN1c3RvbVJ1bGVzW2ldLmNvbnN0cnVjdG9yLnJ1bGUsXG4gICAgICBjdHguY3VzdG9tUnVsZXNbaV0uY29uZmlnXG4gICAgICAgID8gY3R4LmN1c3RvbVJ1bGVzW2ldLmNvbmZpZy5sZXZlbCA6IGN0eC5jdXN0b21SdWxlc1tpXS5fY29uZmlnLmxldmVsLFxuICAgICk7XG5cbiAgICBjb25zdCBlcnJvcnNPbkVudGVyRm9yVHlwZSA9IGN0eC5jdXN0b21SdWxlc1tpXVtkZWZpbml0aW9uLm5hbWVdXG4gICAgICAmJiBjdHguY3VzdG9tUnVsZXNbaV1bZGVmaW5pdGlvbi5uYW1lXSgpW3J1bGVOYW1lXVxuICAgICAgPyBhd2FpdCBjdHguY3VzdG9tUnVsZXNbaV1bZGVmaW5pdGlvbi5uYW1lXSgpW3J1bGVOYW1lXShcbiAgICAgICAgbm9kZUNvbnRleHQucmVzb2x2ZWROb2RlLCBkZWZpbml0aW9uLCBjdHgsIG5vZGUsIHsgdHJhdmVyc2VOb2RlLCB2aXNpdGVkLCByZXNvbHZlVHlwZSB9LFxuICAgICAgKSA6IFtdO1xuXG4gICAgY29uc3QgZXJyb3JzT25FbnRlckdlbmVyaWMgPSBjdHguY3VzdG9tUnVsZXNbaV0uYW55ICYmIGN0eC5jdXN0b21SdWxlc1tpXS5hbnkoKVtydWxlTmFtZV1cbiAgICAgID8gYXdhaXQgY3R4LmN1c3RvbVJ1bGVzW2ldLmFueSgpW3J1bGVOYW1lXShub2RlQ29udGV4dC5yZXNvbHZlZE5vZGUsIGRlZmluaXRpb24sIGN0eCwgbm9kZSwge1xuICAgICAgICB0cmF2ZXJzZU5vZGUsIHZpc2l0ZWQsIHJlc29sdmVUeXBlLFxuICAgICAgfSkgOiBbXTtcblxuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZXJyb3JzT25FbnRlckZvclR5cGUpKSB7XG4gICAgICBjdHgucmVzdWx0LnB1c2goLi4uZXJyb3JzT25FbnRlckZvclR5cGUpO1xuICAgICAgZXJyb3JzLnB1c2goLi4uZXJyb3JzT25FbnRlckZvclR5cGUpO1xuICAgIH1cblxuICAgIGlmIChBcnJheS5pc0FycmF5KGVycm9yc09uRW50ZXJHZW5lcmljKSkge1xuICAgICAgY3R4LnJlc3VsdC5wdXNoKC4uLmVycm9yc09uRW50ZXJHZW5lcmljKTtcbiAgICAgIGVycm9ycy5wdXNoKC4uLmVycm9yc09uRW50ZXJHZW5lcmljKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgdHJhdmVyc2VOb2RlO1xuIl19